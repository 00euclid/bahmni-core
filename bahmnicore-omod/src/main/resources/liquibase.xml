<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <!--
        See http://www.liquibase.org/manual/home#available_database_refactorings
        for a list of supported elements and attributes
    -->
    <changeSet id="bahmni-1" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_10__CreatingPatientIdentifierForBahmni.sql"/>
    </changeSet>
    <changeSet id="bahmni-2" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_23__DeleteOpenMRSCorePersonAttributes.sql"/>
    </changeSet>
    <changeSet id="bahmni-3" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_24__AddUniqueConstraintToPatientidentifier.sql"/>
    </changeSet>
    <changeSet id="bahmni-4" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile splitStatements="false" path="V1_29__AddConceptProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-5" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile splitStatements="false" path="V1_30__AddConceptAnswerProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-6" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile splitStatements="false" path="V1_31__AddConceptWordProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-7" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile splitStatements="false" path="V1_37__SetValueAsConceptIdProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-1" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_39__CreateLaboratoryPanelConcept.sql"/>
    </changeSet>
    <changeSet id="bahmni-9" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_40__AddingConceptWordForLaboratoryConcept.sql"/>
    </changeSet>
    <changeSet id="bahmni-10" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_41__AddingIndexToCityVillage-JssSpecific.sql"/>
    </changeSet>
    <changeSet id="bahmni-11" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_42__RemovingNotNullContraintOnOrderTypeId.sql"/>
    </changeSet>
    <changeSet id="bahmni-12" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_43__AddOPDConsultationEncounterType.sql"/>
    </changeSet>
    <changeSet id="bahmni-31" author="tw" context="rel2">
        <comment>rel2</comment>
        <sqlFile path="V1_10__SetupRegistrationEncounterType.sql"/>
    </changeSet>
    <changeSet id="bahmni-16" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_55__addLabAndRadiologyOrderTypes.sql"/>
    </changeSet>
    <changeSet id="bahmni-17" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile splitStatements="false" path="V1_56__AddConceptDescriptionProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-2" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_57__addDrugDosageInstructionsAndDosageFrequecies.sql"/>
    </changeSet>
    <changeSet id="bahmni-19" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile splitStatements="false" path="V1_58__AddConceptReferenceMapProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-20" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile splitStatements="false" path="V1_59__AddConceptSetMembersProc.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-3" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_60__AddDiagnosisConcepts.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-4" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_62__AddDispositionConcepts.sql"/>
    </changeSet>
    <changeSet id="bahmni-clinical-5" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_66__addConceptConsultationNote.sql"/>
    </changeSet>
    <changeSet id="bahmni-25" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_67__AddConceptSetForAdmission.sql"/>
    </changeSet>
    <changeSet id="bahmni-26" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_68__EncounterTypeForAdmission.sql"/>
    </changeSet>
    <changeSet id="bahmni-27" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_69__AddConceptSetForDischarge.sql"/>
    </changeSet>
    <changeSet id="bahmni-28" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_70__EncounterTypeForDischarge.sql"/>
    </changeSet>
    <changeSet id="bahmni-29" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile splitStatements="false" path="V1_72__AddProcToInsertNewAddressLevel.sql"/>
    </changeSet>
    <changeSet id="bahmni-30" author="tw" context="rel3">
        <comment>rel3</comment>
        <update tableName="patient_identifier_type">
            <column name="name" value="Bahmni Id"/>
            <where>name='JSS'</where>
        </update>
    </changeSet>
    <changeSet id="bahmni-32" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_78__EncounterTypeForTransfer.sql"/>
    </changeSet>
    <changeSet id="bahmni-33" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_71__PatientSearchSql.sql"/>
    </changeSet>
    <changeSet id="bahmni-34" author="tw" context="rel3">
        <comment>rel3</comment>
        <sqlFile path="V1_77__PatientSearchSqlAllAdmittedPatients.sql"/>
    </changeSet>
    <changeSet id="bahmni-35" author="tw" context="rel3">
        <preConditions onFail="HALT">
            <sqlCheck expectedResult="1">
                SELECT COUNT(*) FROM global_property where property = 'emr.primaryIdentifierType'
            </sqlCheck>
        </preConditions>
        <comment>rel3</comment>
        <sqlFile path="V1_61__CreatingGlobalPropertyForPatientIdentifierType.sql"/>
    </changeSet>
    <changeSet id="bahmni-36" author="tw" context="rel3">
        <comment>Add investigations meta data</comment>
        <sql>
            set @concept_id = 0;
            set @answer_concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Lab Departments', 'Lab departments', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'DEPARTMENTS', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'LAB', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'DEPARTMENTS', '1');


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Other Investigations', 'Other Investigations', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'OTHER', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'INVESTIGATIONS', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'OTHER', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'INVESTIGATIONS', '1');


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id, 'Other Investigations Categories', 'Other Investigations Categories', 'N/A', 'ConvSet', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'OTHER', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'INVESTIGATIONS', '1');
            call add_concept_word(@concept_id, @concept_name_short_id, 'CATEGORIES', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'OTHER', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'INVESTIGATIONS', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'CATEGORIES', '1');
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-6" author="Hemanth" context="rel3">
        <comment>Add concept Adt Notes</comment>
        <sql>
            insert into concept (retired, short_name, description, datatype_id, class_id, is_set, creator, date_created,
            changed_by, date_changed, uuid)
            values (0, 'Adt Notes', 'Adt Notes',
            (select concept_datatype_id from concept_datatype where name = 'Text'),
            (select concept_class_id from concept_class where name = 'Misc'),
            0, 1, now(), 1, now(), uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-7" author="Hemanth" context="rel3">
        <comment>Add concept-name Adt Notes</comment>
        <sql>
            insert into concept_name (concept_id, name, locale, locale_preferred, creator, date_created,
            concept_name_type, voided, uuid)
            values ((select concept_id from concept where short_name='Adt Notes'),
            'Adt Notes', 'en', 1, 1, now(), 'FULLY_SPECIFIED', 0, uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-8" author="Praveen" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property where property = 'bahmni.encountersession.duration'
            </sqlCheck>
        </preConditions>
        <comment>Add encounter session duration</comment>
        <sql>
            insert into global_property (`property`, `property_value`, `description`, `uuid`)
            values ('bahmni.encountersession.duration',
            '60',
            'Encountersession duration in minutes',
            uuid()
            );
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-9" author="Praveen" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*) FROM global_property where property = 'emr.encounterMatcher'
            </sqlCheck>
        </preConditions>
        <comment>Add custom encounter session matcher</comment>
        <sql>
            insert into global_property (`property`, `property_value`, `description`, `uuid`)
            values ('emr.encounterMatcher',
            'org.bahmni.module.bahmnicore.matcher.EncounterSessionMatcher',
            'custom encounter session matcher',
            uuid()
            );
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-10" author="Vivek" context="rel3">
        <comment>Add concept words for adt notes</comment>
        <sql>
            select concept_id INTO @concept_id from concept where short_name='Adt Notes';
            select concept_name_id INTO @concept_name_full_id from concept_name where concept_id = (select concept_id from concept where short_name='Adt Notes');

            call add_concept_word(@concept_id, @concept_name_full_id, 'Adt', '1');
            call add_concept_word(@concept_id, @concept_name_full_id, 'Notes', '1');
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-11" author="Arathy" context="rel3">
        <comment>Add concept Document</comment>
        <sql>
            insert into concept (retired, short_name, description, datatype_id, class_id, is_set, creator, date_created,
            changed_by, date_changed, uuid)
            values (0, 'Document', 'Document',
            (select concept_datatype_id from concept_datatype where name = 'Text'),
            (select concept_class_id from concept_class where name = 'Misc'),
            0, 1, now(), 1, now(), uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-12" author="Arathy" context="rel3">
        <comment>Add concept-name Document</comment>
        <sql>
            insert into concept_name (concept_id, name, locale, locale_preferred, creator, date_created,
            concept_name_type, voided, uuid)
            values ((select concept_id from concept where short_name='Document'),
            'Document', 'en', 1, 1, now(), 'FULLY_SPECIFIED', 0, uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-13" author="Arathy" context="rel3">
        <comment>Add Encounter Type Radiology</comment>
        <sql>
            insert into encounter_type (name, description, creator, date_created, uuid)
            VALUES ('RADIOLOGY', 'RADIOLOGY encounter', 1, curdate(), uuid());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-201401171353" author="banka-tw" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:clinical'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:clinical"/>
            <column name="description" value="Bahmni clinical app access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>

    <changeSet id="bahmni-clinical-201401171415" author="banka-tw" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:radiologyOrders'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:radiologyOrders"/>
            <column name="description" value="Bahmni radiology orders access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>

    <changeSet id="bahmni-clinical-201401171420" author="banka-tw" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:documents'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:documents"/>
            <column name="description" value="Privilege to access the documents scanning app"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-clinical-14" author="Praveen" context="rel3">
        <comment>Add new encounter type for investigation</comment>
        <sql>
            INSERT INTO encounter_type (name, description, creator, date_created, uuid) VALUES ('INVESTIGATION', 'Investigation encounter', 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-37" author="tw" context="rel3">
        <comment>Add job for processing reference data</comment>
        <sql>
            INSERT INTO scheduler_task_config(name, schedulable_class, start_time, start_time_pattern, repeat_interval,start_on_startup, started, created_by, date_created, uuid)
            VALUES ('Reference Data Task', 'org.bahmni.module.referncedatafeedclient.task.ReferenceDataFeedTask', now(),'MM/dd/yyyy HH:mm:ss', 60, 1, 0, 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-38" author="tw" context="rel3">
        <comment>Add job for processing failed reference data</comment>
        <sql>
            INSERT INTO scheduler_task_config(name, schedulable_class, start_time, start_time_pattern, repeat_interval,start_on_startup, started, created_by, date_created, uuid)
            VALUES ('Reference Data Failed Event Task', 'org.bahmni.module.referncedatafeedclient.task.ReferenceDataFailedEventTask', now(),'MM/dd/yyyy HH:mm:ss', 60, 1, 0, 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-39" author="tw" context="rel3">
        <comment>Update class name of reference data feed task and failed event task.</comment>
        <sql>
            UPDATE scheduler_task_config SET schedulable_class = 'org.bahmni.module.referencedatafeedclient.task.ReferenceDataFeedTask' WHERE name = 'Reference Data Task';
            UPDATE scheduler_task_config SET schedulable_class = 'org.bahmni.module.referencedatafeedclient.task.ReferenceDataFailedEventTask' WHERE name = 'Reference Data Failed Event Task';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201401281730" author="Banka,RT" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from encounter_type where name = 'LAB_RESULT'</sqlCheck>
        </preConditions>
        <comment>Add new encounter type for Lab Result</comment>
        <sql>
            INSERT INTO encounter_type (name, description, creator, date_created, uuid) VALUES ('LAB_RESULT', 'Lab Result encounter', 1, curdate(), uuid());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201401311600" author="TW" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from concept_name where name = 'LAB_RESULTS_CONCEPT_SET'
            </sqlCheck>
        </preConditions>
        <comment>Add concept set for Lab results</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;

            set @answer_concept_id = 0;
            call add_concept(@concept_id, @concept_name_short_id,
            @concept_name_full_id,'LABRESULTS_CONCEPT','LABRESULTS_CONCEPT', 'N/A', 'Finding', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LABRESULTS', 1);

            set @labresults_concept_id = @concept_id;

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_RESULT','LAB_RESULT',
            'Text', 'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'RESULT', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);


            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_NOTES','LAB_NOTES', 'Text',
            'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'NOTES', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_MINNORMAL','LAB_MINNORMAL',
            'Numeric', 'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'MINNORMAL', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_MAXNORMAL','LAB_MAXNORMAL',
            'Numeric', 'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'MAXNORMAL', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);

            call add_concept(@concept_id, @concept_name_short_id, @concept_name_full_id,'LAB_ABNORMAL','LAB_ABNORMAL',
            'Boolean', 'Finding', false);
            call add_concept_word(@concept_id, @concept_name_short_id, 'LAB', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'ABNORMAL', 1);
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402061215" author="Angshu,RT" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from visit_type where name = 'LAB_RESULTS_IN_ABSENTEE'</sqlCheck>
        </preConditions>
        <comment>Add new visit type LAB_RESULTS_IN_ABSENTEE</comment>
        <sql>
            INSERT INTO visit_type (name, description, creator, uuid, date_created) VALUES ('LAB_RESULTS_IN_ABSENTEE', 'Visit for which results come when patient is not present', 1, uuid(), curdate());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402101443" author="sush" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:document-upload'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:document-upload"/>
            <column name="description" value="bahmni document upload access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-clinical-201402111716" author="indraneel,neha" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from privilege where privilege = 'app:adt'</sqlCheck>
        </preConditions>
        <insert tableName="privilege">
            <column name="privilege" value="app:adt"/>
            <column name="description" value="bahmni adt access privilege"/>
            <column name="uuid" valueComputed="uuid()"/>
        </insert>
    </changeSet>
    <changeSet id="bahmni-clinical-201402131522" author="Angshu,RT" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from visit_type where name = 'LAB_VISIT'</sqlCheck>
        </preConditions>
        <comment>Creating new visit type LAB_VISIT</comment>
        <sql>
            INSERT INTO visit_type (name, description, creator, uuid, date_created) VALUES ('LAB_VISIT', 'Visits for lab visit by patient when the tests are not ordered through OpenMRS', 1, uuid(), curdate());
        </sql>
    </changeSet>

    <changeSet id="bahmni-clinical-201402161951" author="Mujir,Vinay" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from visit_type where name = 'DRUG_ORDER'</sqlCheck>
        </preConditions>
        <comment>Creating new visit type DRUG_ORDER</comment>
        <sql>
            INSERT INTO visit_type (name, description, creator, uuid, date_created) VALUES ('DRUG_ORDER', 'Placeholder visit for orders created when no visit is open', 1, uuid(), curdate());
        </sql>
    </changeSet>

    <changeSet id="bahmni-40" author="tw" context="rel3">
        <comment>Allow registration clerk to manage encounter roles</comment>
        <sql>
            INSERT INTO role_privilege(role, privilege) VALUES('RegistrationClerk', 'Manage Encounter Roles')
            ON DUPLICATE KEY UPDATE role = 'RegistrationClerk';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402182015" author="Mujir,Vinay,Shruthi" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from visit_type where name = 'PHARMACY_VISIT'</sqlCheck>
        </preConditions>
        <comment>Add new visit type PHARMACY_VISIT</comment>
        <sql>
            INSERT INTO visit_type (name, description, creator, uuid, date_created) VALUES ('PHARMACY_VISIT', 'Visit for PHARMACY_VISIT', 1, uuid(), curdate());
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402201226" author="Neha,Indraneel" context="rel3">
        <comment>deleting visit types DRUG_ORDER and LAB_RESULTS_IN_ABSENTEE</comment>
        <sql>
            DELETE from visit_type where name in ('DRUG_ORDER','LAB_RESULTS_IN_ABSENTEE');
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402201520" author="Angshu" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from global_property where property = 'emr.primaryIdentifierType'</sqlCheck>
        </preConditions>
        <comment>Add global property for emr primary identifier type</comment>
        <sql>
            INSERT INTO global_property (property, uuid, description) values ('emr.primaryIdentifierType', UUID(), 'Primary identifier type for looking up patients, generating barcodes, etc') ON DUPLICATE KEY UPDATE description = 'Primary identifier type for looking up patients, generating barcodes, etc';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402201530" author="Angshu" context="rel3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from patient_identifier_type where name = 'Bahmni Id'</sqlCheck>
        </preConditions>
        <comment>set global property value for emr primary identifier type</comment>
        <sql>
            update global_property set property_value = (select uuid from patient_identifier_type where name = 'Bahmni Id') where property = 'emr.primaryIdentifierType';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402201700" author="D3" context="rel3">
        <comment>Remove unused app:documents privilege</comment>
        <sql>
            DELETE from role_privilege where privilege = 'app:documents';
            DELETE from privilege where privilege = 'app:documents';
        </sql>
    </changeSet>
    <changeSet id="bahmni-clinical-201402251700" author="Mihir,Vinay">
        <comment>Add new concept to mark referred out tests</comment>
        <sql>
            set @concept_id = 0;
            set @concept_name_short_id = 0;
            set @concept_name_full_id = 0;
            set @labresults_concept_id = 0;

            set @answer_concept_id = 0;
            call add_concept(@concept_id, @concept_name_short_id,
            @concept_name_full_id,'REFERRED_OUT','REFERRED_OUT', 'N/A', 'Misc', true);
            call add_concept_word(@concept_id, @concept_name_short_id, 'REFERRED', 1);
            call add_concept_word(@concept_id, @concept_name_short_id, 'OUT', 1);
            select @labresults_concept_id := concept_id, min(concept_id) from concept_name where name = 'LABRESULTS_CONCEPT';
            set @set_concept_id = @concept_id;
            call add_concept_set_members (@labresults_concept_id,@set_concept_id,1);

        </sql>
    </changeSet>
</databaseChangeLog>
