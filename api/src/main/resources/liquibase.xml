<?xml version="1.0" encoding="UTF-8"?>
 
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
  	
    <changeSet id="2012-05-10_create_raxacore_patient_list" author="tarang">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="raxacore_patient_list"/>
            </not>
        </preConditions>
        <comment>
            Schema for raxacore_patient_list table
        </comment>
        <createTable tableName="raxacore_patient_list">
            <column name="patient_list_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="name" type="varchar(255)"/>
            <column name="description" type="varchar(2000)"/>
            <column name="search_query" type="varchar(1000)"/>
            
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="DATETIME"/>
            <column defaultValueBoolean="false" name="retired" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="retired_by" type="int"/>
            <column name="date_retired" type="DATETIME"/>
            <column name="retire_reason" type="varchar(255)"/>
            <column name="uuid" type="char(38)">
                <constraints unique="true" nullable="false"/>
            </column>
        </createTable>
    </changeSet>
    <changeSet id="2012-05-10_add_constraints_to_raxacore_patient_list" author="johnstoecker">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="raxacore_patient_list"/>
        </preConditions>
        <comment>
            Adding constraints for auditing PatientList--making sure
            anyone who creates/voids a PatientList table is a user
        </comment>
        <addForeignKeyConstraint baseTableName="raxacore_patient_list" 
                                 baseColumnNames="creator" 
                                 constraintName="FK_raxacore_patient_list_creator_users_user_id" 
                                 referencedTableName="users" 
                                 referencedColumnNames="user_id"/>
        <addForeignKeyConstraint baseTableName="raxacore_patient_list" 
                                 baseColumnNames="retired_by" 
                                 constraintName="FK_raxacore_patient_list_retired_by_users_user_id" 
                                 referencedTableName="users" 
                                 referencedColumnNames="user_id"/>
        <addForeignKeyConstraint baseTableName="raxacore_patient_list" 
                                 baseColumnNames="changed_by" 
                                 constraintName="FK_raxacore_patient_list_changed_by_users_user_id" 
                                 referencedTableName="users" 
                                 referencedColumnNames="user_id"/>
    </changeSet>    
    
    
    
 	  
 	   
 	     <changeSet id="2012-07-18_create_drug_purchase_order" author="Abhishek,Jatin,Praneet">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="drug_purchase_order"/>
            </not>
        </preConditions>
        <comment>
            Schema for drug_purchase_order table
        </comment>
        <createTable tableName="drug_purchase_order">
            <column name="PO_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="PO_name" type="varchar(255)"/>
            <column name="PO_description" type="varchar(2000)"/>
            
            
            <column defaultValueBoolean="false" name="Received" type="boolean">
                 <constraints nullable="false"/>
             </column>
            
            
            
            <column name="Provider" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="Location" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="PO_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            
            
            
          
            
            <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="DATETIME"/>
            <column defaultValueBoolean="false" name="retired" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="retired_by" type="int"/>
            <column name="date_retired" type="DATETIME"/>
            <column name="retire_reason" type="varchar(255)"/>
            <column name="uuid" type="char(38)">
                <constraints unique="true" nullable="false"/>
            </column>
        </createTable>
     </changeSet> 
 	   <changeSet id="2012-07-18_add_constraints_to_drug_purchase_order" author="Abhishek,Jatin,Praneet">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="drug_purchase_order"/>
        </preConditions>
        <comment>
            Adding constraints for drug_purchase_order.
        </comment>
        
          
        <addForeignKeyConstraint baseTableName="drug_purchase_order" 
                                 baseColumnNames="provider" 
                                 constraintName="FK_drug_purchase_order_provider_provider_provider_id" 
                                 referencedTableName="provider" 
                                 referencedColumnNames="provider_id"/>
        
      
        
          <addForeignKeyConstraint baseTableName="drug_purchase_order" 
                                 baseColumnNames="location" 
                                 constraintName="FK_drug_purchase_order_location_location_location_id" 
                                 referencedTableName="location" 
                                 referencedColumnNames="location_id"/>
        
    </changeSet>
 	   
 	   
 	   
 	   
 	   
 	   
 	   
    
    
    
    
    
    
    
    
     <changeSet id="2012-07-18_create_drug_inventory_resource" author="Abhishek,Jatin,Praneet">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="drug_inventory_resource"/>
            </not>
        </preConditions>
        <comment>
            Schema for drug_inventory_resource table
        </comment>
        <createTable tableName="drug_inventory_resource">
            <column name="DI_id" type="int" autoIncrement="true">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="DI_name" type="varchar(255)"/>
            <column name="DI_description" type="varchar(2000)"/>
           
            
            <column name="Drug" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="Quantity" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="Expiry_date" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            
             <column name="Batch" type="varchar(255)"/>
             
              <column name="Value" type="int">
                <constraints nullable="false"/>
            </column>
            
                          <column name="Status" type="varchar(255)"/>
              
              
            <column name="Provider" type="int">
                <constraints nullable="false"/>
            </column>
            
            <column name="Drug_PO" type="int">
                <constraints nullable="false"/>
            </column>
            
            <column name="Location" type="int">
                <constraints nullable="false"/>
            </column>
            
            
           
            
           
             <column name="creator" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="date_created" type="DATETIME">
                <constraints nullable="false"/>
            </column>
            <column name="changed_by" type="int"/>
            <column name="date_changed" type="DATETIME"/>
            <column defaultValueBoolean="false" name="retired" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="retired_by" type="int"/>
            <column name="date_retired" type="DATETIME"/>
            <column name="retire_reason" type="varchar(255)"/>
            <column name="uuid" type="char(38)">
                <constraints unique="true" nullable="false"/>
            </column>
        </createTable>
     </changeSet> 
 	   <changeSet id="2012-07-18_add_constraints_to_drug_inventory_resource" author="Abhishek,Jatin,Praneet">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="drug_inventory_resource"/>
        </preConditions>
        <comment>
            Adding constraints for drug_inventory_resource.
        </comment>
     
        
         <addForeignKeyConstraint baseTableName="drug_inventory_resource" 
                                 baseColumnNames="Provider_recepient" 
                                 constraintName="FK_drug_inventory_resource_Provider_provider_provider_id" 
                                 referencedTableName="provider" 
                                 referencedColumnNames="provider_id"/>
        
      
        
          <addForeignKeyConstraint baseTableName="drug_inventory_resource" 
                                 baseColumnNames="location" 
                                 constraintName="FK_drug_inventory_resource_location_location_location_id" 
                                 referencedTableName="location" 
                                 referencedColumnNames="location_id"/>
          
          
           <addForeignKeyConstraint baseTableName="drug_inventory_resource" 
                                 baseColumnNames="Drug_PO" 
                                 constraintName="FK_drug_inventory_resource_Drug_PO_drug_purchase_order_PO_id" 
                                 referencedTableName="drug_purchase_order" 
                                 referencedColumnNames="PO_id"/>
           
           
            
           <addForeignKeyConstraint baseTableName="drug_inventory_resource" 
                                 baseColumnNames="Drug" 
                                 constraintName="FK_drug_inventory_Drug_Drug_Drug_id" 
                                 referencedTableName="drug" 
                                 referencedColumnNames="drug_id"/>
    </changeSet>
 
 	   
 	   
 	   
 	   
 	   
 	   
 	   
 	   
 	   
 	   
 	   
 	   
 	   
</databaseChangeLog>